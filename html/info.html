<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autopulse</title>
    <link rel="stylesheet" href="/css/style2.css">
    <link rel="stylesheet" href="/css/nav.css">
    <link rel="stylesheet" href="/css/header.css">
</head>
<body>
    <header>
        <div class="nav-buttons">
            <span>Información del Vehículo</span>
        </div>
        <i class="fa-solid fa-question-circle" onclick="preguntar()"></i>
    </header>
    <div class="tarjetaCarro">
        <i class="fa-solid fa-arrow-left flechatras" onclick="regresar()"></i>
        <!-- Imagen del carro -->
        <div class="fotoCarro">
            <h2>Toyota</h2>
            <img src="images/sedan.png" alt="Vehículo">
        </div>

        <div class="info-general">
            <div class="Titulo" id="titulo-info-general">
                <h1>Información General <i class="fa-solid fa-chevron-down"></i></h1>
            </div>

            <div class="infoCarro" id="infoCarro">
                <div class="Info-Respuesta">
                    <p><b>Modelo:</b></p>
                    <span class="linea"></span>
                    <p>Matrix XRS</p>
                </div>
                <div class="Info-Respuesta">
                    <p><b>Año:</b></p>
                    <span class="linea"></span>
                    <p>2005</p>
                </div>
                <div class="Info-Respuesta">
                    <p><b>Condición:</b></p>
                    <span class="linea"></span>
                    <p><span class="statusPromedio">Promedio</span></p>
                </div>
                <div class="Info-Respuesta">
                    <p><b>Kilometraje:</b></p>
                    <span class="linea"></span>
                    <p>246,466 KM</p>
                </div>
                <div class="Info-Respuesta">
                    <p><b>Tamaño de Llantas:</b></p>
                    <span class="linea"></span>
                    <p>215/65 R15</p>
                </div>
                <div class="Info-Respuesta">
                    <p><b>Tipo de Rin:</b></p>
                    <span class="linea"></span>
                    <p>6.5Jx16 ET39</p>
                </div>
                <div class="Info-Respuesta">
                    <p><b>Pintura original:</b></p>
                    <span class="linea"></span>
                    <p>Radiant Red</p>
                </div>
            </div>
        </div>

        <div class="info-manto">
            <div class="Titulo" id="titulo-info-manto">
                <h1>Mantenimiento <i class="fa-solid fa-chevron-down"></i></h1>
            </div>
            <div class="infoCarro" id="infoManto">
                <div class="Info-Respuesta">
                    <p><b>Ultimo Mantenimiento:</b></p>
                    <span class="linea"></span>
                    <p>28/09/2024</p>
                </div>
                <div class="Info-Respuesta">
                    <p><b>Ultimo Cambio de Aceite:</b></p>
                    <span class="linea"></span>
                    <p>28/09/2024</p>
                </div>
            </div>
        </div>
    </div>
    <nav>
        <i class="fa-solid fa-house casita" onclick="princi()" title="Inicio"></i>
        <i class="fa-solid fa-bell" onclick="verNotificaciones()" title="Notificaciones"></i>
        <i class="fa-solid fa-location-dot" onclick="ubicar()" title="Ubicaciones"></i>
        <h1 class="nombre">Autopulse</h1>
        <i class="fa-solid fa-gears config" onclick="registrar()" title="Registrar Auto"></i>
        <i class="fa-solid fa-wrench" onclick="agregarServicio()" title="Agregar Servicio"></i>
        <i class="fa-solid fa-right-from-bracket" onclick="cerrarSesion()" title="Cerrar sesión"></i>
    </nav>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const userId = localStorage.getItem("userid");
            if (!userId) {
                alert("Error: No se encontró el User ID. Por favor, inicia sesión.");
                return;
            }
    
            try {
                // Llamar al endpoint para obtener los vehículos del usuario
                const response = await fetch(`https://backend-autoplus.onrender.com/users/${userId}/vehicles`);
                if (!response.ok) throw new Error("Error al obtener los vehículos.");
        
                const vehicles = await response.json();
    
                // Obtener el ID del primer vehículo para simplificar (o seleccionarlo desde el frontend)
                if (vehicles.length === 0) {
                    alert("No se encontraron vehículos para este usuario.");
                    return;
                }
    
                const vehicleId = vehicles[0].id; // Cambiar si se necesita manejar múltiples vehículos
                const maintenanceResponse = await fetch(`https://backend-autoplus.onrender.com/vehicles/${vehicleId}/serviceHistory/`);
                if (!maintenanceResponse.ok) throw new Error("Error al obtener el historial de mantenimiento.");
    
                const maintenanceData = await maintenanceResponse.json();
    
                // Asumimos que `maintenanceData` es un array de objetos con información de servicios
                const ultimoMantenimiento = maintenanceData.find(service => service.serviceType === "Mantenimiento");
                const ultimoCambioAceite = maintenanceData.find(service => service.serviceType === "Cambio de aceite");
    
                // Mostrar información en el apartado de mantenimiento
                const infoMantoDiv = document.getElementById("infoManto");
                infoMantoDiv.innerHTML = `
                    <div class="Info-Respuesta">
                        <p><b>Último Mantenimiento:</b></p>
                        <span class="linea"></span>
                        <p>${ultimoMantenimiento ? new Date(ultimoMantenimiento.serviceDate).toLocaleDateString() : "No disponible"}</p>
                    </div>
                    <div class="Info-Respuesta">
                        <p><b>Último Cambio de Aceite:</b></p>
                        <span class="linea"></span>
                        <p>${ultimoCambioAceite ? new Date(ultimoCambioAceite.serviceDate).toLocaleDateString() : "No disponible"}</p>
                    </div>
                `;
            } catch (error) {
                console.error("Error al cargar la información de mantenimiento:", error.message);
                alert("No se pudo cargar la información de mantenimiento. Intenta más tarde.");
            }
        });
    </script>
    

</body>
</html>
<script src="/script.js"></script>
<script src="https://kit.fontawesome.com/dad89e78ab.js" crossorigin="anonymous"></script>