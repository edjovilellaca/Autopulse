<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autopulse</title>
    <link rel="stylesheet" href="css/style2.css">
    <link rel="stylesheet" href="css/nav.css">
    <link rel="stylesheet" href="css/header.css">
    <style>
        #vehicleDetails {
            display: flex;
            flex-direction: column; /* Cambiado a columna para apilar elementos */
            align-items: flex-start;
            margin: 20px;
        }

        .card {
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px; /* Espacio entre la imagen y la información */
            width: 100%; /* Asegura que la tarjeta ocupe el ancho completo */
        }

        #imagen-vehiculo {
            max-width: 300px;
            margin-bottom: 20px; /* Espacio debajo de la imagen */
        }

        nav {
            margin-top: 20px; /* Espacio adicional para el título */
        }

        h1.nombre {
            margin-top: 40px; /* Ajustar el margen para que esté más abajo */
        }
    </style>
</head>
<body>
    <div id="vehicleDetails">
        <header>
            <h1>Detalles del Vehículo</h1>
        </header>
        <div class="card">
            <img id="imagen-vehiculo" src="" alt="Imagen del Vehículo">
        </div>
        <div class="card">
            <h2 id="marca-vehiculo"></h2>
            <details>
                <summary>Información General</summary>
                <div>
                    <p><strong>Modelo:</strong> <span id="modelo"></span></p>
                    <p><strong>Año:</strong> <span id="anio"></span></p>
                    <p><strong>Kilometraje:</strong> <span id="kilometraje"></span></p>
                    <p><strong>VIN:</strong> <span id="vin"></span></p>
                    <p><strong>Placa:</strong> <span id="placa"></span></p>
                </div>
            </details>
        </div>
        <div class="card">
            <h2>Servicios</h2>
            <details>
                <summary>Ver Historial de Servicios</summary>
                <div>
                    <ul id="historial-servicios">
                        <!-- Aquí se agregarán los servicios -->
                    </ul>
                </div>
            </details>
        </div>
        <div class="card">
            <h2>Modificaciones</h2>
            <details>
                <summary>Ver Historial de Modificaciones</summary>
                <div>
                    <ul id="historial-modificaciones">
                        <!-- Aquí se agregarán los servicios -->
                    </ul>
                </div>
            </details>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const userId = localStorage.getItem("userid");
            const vehicleId = localStorage.getItem("vehicleId");

            // Console logs para verificar la recepción de los IDs
            console.log("User  ID en info.html:", userId);
            console.log("Vehicle ID en info.html:", vehicleId);

            if (!userId || !vehicleId) {
                alert("No se encontró información del usuario o del vehículo. Por favor, vuelve a la página anterior.");
                return;
            }

            try {
                const responseAutos = await fetch(`https://backend-autoplus.onrender.com/users/${userId}/vehicles/${vehicleId}/`);
                const responseServicios = await fetch(`https://backend-autoplus.onrender.com/users/${userId}/vehicles/${vehicleId}/serviceHistory`);
                const responseModificaciones = await fetch(`https://backend-autoplus.onrender.com/users/${userId}/vehicles/${vehicleId}/vehicleModifications`);

                if (!responseAutos.ok) {
                    throw new Error('Error en la red');
                }

                const vehiculo = await responseAutos.json();
                const historialServicios = await responseServicios.json(); // Suponiendo que el historial de servicios está en el objeto vehiculo
                const historialModificaciones = await responseModificaciones.json();

                // Actualizar la información del vehículo en la página
                document.getElementById("marca-vehiculo").innerText = vehiculo.make; // Marca
                document.getElementById("imagen-vehiculo").src = vehiculo.imageUrl; // Mostrar la imagen
                document.getElementById("modelo").innerText = vehiculo.model; // Modelo
                document.getElementById("anio").innerText = vehiculo.year; // Año
                document.getElementById("kilometraje").innerText = vehiculo.mileage; // Kilometraje
                document.getElementById("vin").innerText = vehiculo.vin; // VIN
                document.getElementById("placa").innerText = vehiculo.licensePlate; // Placa

                // // Aquí puedes agregar la lógica para cargar el historial de servicios
                const historialServiciosList = document.getElementById("historial-servicios");

                historialServicios.forEach(servicio => {
                    const li = document.createElement("li");
                    li.innerText = `Servicio: ${servicio.serviceType}, Fecha: ${servicio.serviceDate}, Costo: ${servicio.cost}`;
                    historialServiciosList.appendChild(li);
                });

                const historialModificacionesList = document.getElementById("historial-modificaciones")

                historialModificaciones.forEach(modificacion => {
                    const li = document.createElement("li");
                    li.innerText = `Tipo: ${modificacion.modificationType}, Costo: ${modificacion.cost}, Taller: ${modificacion.performedBy}`;
                    
                    historialModificacionesList.appendChild(li);
                })
            } catch (error) {
                console.error('Error al obtener la información del vehículo:', error);
                alert("No se pudo cargar la información del vehículo.");
            }
        });
    </script>
    <nav>
        <i class="fa-solid fa-house casita" onclick="princi()"></i>
        <i class="fa-solid fa-bell" onclick="verNotificaciones()"></i>
        <i class="fa-solid fa-location-dot" onclick="ubicar()"></i>
        <i class="fa-solid fa-gears config" onclick="registrar()"></i>
        <i class="fa-solid fa-right-from-bracket" onclick="cerrarSesion()" title="Cerrar sesión"></i>
        <i class="fa-solid fa-wrench" onclick="agregarServicio()" title="Agregar Servicio"></i>
    </nav>
</body>
</html>
<script src="script.js"></script>
<script src="https://kit.fontawesome.com/dad89e78ab.js" crossorigin="anonymous"></script>